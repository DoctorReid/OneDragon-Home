---
lang: zh-CN
title: 朱鸢配队教程-01-站场逻辑
---

## 0.前置说明

在开始前，请先学习 [Yaml文件格式](../basic/basic_01_yaml.md) 和 [自动战斗原理](../basic/basic_02.md)。

本教程的目的，是通过 `朱鸢+击破+支援` 的配队 来展示怎么写出一份自动战斗的配置文件，如何将自己的实战思路转化到脚本实现。

教程的每个章节会尽量短，避免大家时间不足或会长篇大论而失去兴趣。

作者的游戏理解未必到位，请不要在具体逻辑上挑刺，你可以在学习后实现自己的战斗逻辑。

如果你没有朱鸢，也可以更换成其它强攻的角色。

如果你想写其它类型的配队，也可以跟着本教程，理解后，在关键位置替换成你的逻辑。


## 1.准备工作

首先，我们进入游戏的训练场，选择 `朱鸢+击破+支援` 的配队，然后开启怪物的无敌，关闭移动和失衡。

然后我们在 `config/auto_battle` 文件夹下新建一个文件 `朱鸢教程.yml`。

你可以选择跟着本章节自己慢慢填写文件内容，或者直接复制本章节的最后成果，在 `config/auto_battle/docs/朱鸢教程/01.yml`。

## 2.站场逻辑

写一份自动战斗配置，第一点需要的就是确定你的站场逻辑，什么时候让哪个角色上场。

以 `朱鸢+击破+支援` 的配队为例，可以粗略分以下两种场景

- 怪物失衡前 - 由击破角色站场，尽快打出怪物的失衡
- 怪物失衡后 - 由朱鸢(强攻)站场，爆发打输出


## 3.击破站场

确定以上逻辑后，我们将以下内容复制到 `朱鸢教程.yml` 中

<details>
<summary> 示例 </summary>

```yaml
scenes:
  - triggers: [ ]
    handlers:
      - states: "[前台-击破]"
        operations:
          - op_name: "按键-普通攻击"
            post_delay: 0.2
      - states: "[后台-2-击破]"
        operations:
          - op_name: "按键-切换角色-上一个"
            post_delay: 0.1
      - states: "[后台-1-击破]"
        operations:
          - op_name: "按键-切换角色-下一个"
            post_delay: 0.1
```

</details>

然后，脚本中打开 `战斗助手-自动战斗`，战斗配置中选择 `朱鸢教程`，点击开始。

然后你应该可以在游戏中看到，朱鸢被换下场，由击破角色在不断普通攻击。

你可以尝试按切换角色的按键，看看脚本是否会自动把角色切换回击破。

### 3.1.逻辑解释

只看中文部分，我们先来粗略理解这部分内容

1. 如果前台角色是击破，那么就按普通攻击；
2. 如果1不满足，就判断后台第2个角色是否击破，如果是，则触发按键 切换角色-上一个；以此切换到击破角色；
3. 如果2不满足，就判断后台第1个角色是否击破，如果是，则触发按键 切换角色-下一个；以此切换到击破角色；

<details>
<summary> 为什么有时候需要切换多次才回到击破的角色 </summary>

这是游戏比较隐藏的一个设定，在切换角色的时候，如果你比较连续地下一个和上一个各按一次，最后会切换到3P角色。

这是因为当你按下一个的时候，会切换到2P。

如果这时候在1P还没有退场的时候按了上一个，由于1P还在场，无法切换到1P，游戏会继续找上一个，也就是3P。

而上述脚本由于运行较快，在你人工按下一个之后，脚本较快地识别到前台不是击破，这时候脚本发出一个切换角色的指令，想切换到击破角色。

而击破角色又还没有退场，所以就会在游戏中看到切换到再另一个角色。最后通过多次切换才换回到击破角色。

</details>


### 3.2.配置解释

在理解了上述逻辑后，我们再来理解这个配置文件的写法

#### 3.2.1.整体

整个自动战斗的配置文件，只包含了一个对象，在本项目中会统称为 `自动战斗配置`。

`自动战斗配置`中，会包含多个属性，完整属性后续再提供文档。

上述例子中，就只使用了1个属性 scenes

#### 3.2.1.场景 (scenes)

scenes属性是一个数组，数组中每个元素是一个对象，在本项目中会统称为 `场景`。

`场景`属性，是用来罗列战斗中可能出现的场景，包括出现闪光，出现连携等。

一个`场景`对象，里面可以包含以下属性

- triggers `触发条件数组` - 在什么情况下，需要触发这个场景。
- handlers `处理方法数组` - 在这个场景下，需要有哪些处理方法，也就是对应的操作。

上述例子中，就只有1个场景，该场景不需要任何触发，可以暂不理解。

#### 3.2.2.处理方法数组 (handlers)

`处理方法数组` 中，包含多个元素，每个元素是一个 `处理方法` 对象。

一个`场景`对象，里面包含以下属性

- states `状态判断表达式` - 在这个场景下，进一步判断当前是什么状态。
- operations `操作指令数组` - 在这个状态下，需要进行的具体操作。

上述例子中，主要区分了3种状态：击破在前场；在后台1；在后台2。

每种状态下再有对应的操作。

#### 3.2.3.状态判断表达式 (states)

`状态判断表达式` 是一个文本(字符串)，因此它的值使用双引号包围。




